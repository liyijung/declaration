<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>出口報單</title>
    <link rel="stylesheet" href="Export_format/styles.css">
</head>
<body>
    <!--固定在頁面頂部-->
    <div class="tabs-wrapper">
        <div class="tabs">
            <div class="tab-links active" onclick="openTab('header')">出口報單表頭</div>
            <div class="tab-links" onclick="openTab('items')">出口報單項次</div>
            <div class="tab-links" onclick="openTab('bonded')">保稅相關信息</div>
            <div class="tab-links" onclick="openTab('transfer-customer')">轉檔客戶專區</div>
        </div>
    </div>

    <p id="dynamicMargin" style="margin-top: 0;"></p>

    <div class="scroll-container">
        <!-- 移至頁面最上方按鈕 -->
        <button class="scroll-btn up" onclick="scrollToTop()" title="移至頁面最上方" tabindex="-1">▲</button>
        <!-- 移至頁面最下方按鈕 -->
        <button class="scroll-btn down" onclick="scrollToBottom()" title="移至頁面最下方" tabindex="-1">▼</button>
    </div>
    
    <!--出口報單表頭-->    
    <div id="header" class="tab active">
        <div class="header-section">
            <div class="header-group" style="margin-top: 0px; margin-bottom: 0px;">
                <label for="REMARK" style="background: #ffffff00;">【檔名加註】</label>
                <input type="text" id="REMARK" name="REMARK" tabindex="-1"
                placeholder="(有需要再填，會加在檔名後，可做備註用)">
            </div>
        </div>
        
        <div class="header-section">
            <div class="header-group">
                <label for="FILE_NO">文件編號</label>
                <input type="text" id="FILE_NO" name="FILE_NO" oninput="filterNumbers(this)">
            </div>
            <div class="header-group">
                <label for="LOT_NO">運單號</label>
                <input type="text" id="LOT_NO" name="LOT_NO" oninput="filterSFAndNumbers(this)">
            </div>
            <hr>
            <div class="header-group">
                <label for="SHPR_BAN_ID">出口人統一編號</label>
                <input type="text" id="SHPR_BAN_ID" name="SHPR_BAN_ID" oninput="filterAlphanumeric(this)"
                placeholder="輸入統一編號以查找資料" onkeydown="preventArrowKeyAdjustment(event)">
                <span id="noDataMessage" style="color: rgba(255, 0, 0, 0.634); display: none; margin-left: 4px; margin-right: 4px; margin-top: 4px;">查無資料</span>
                <button type="button" title="出口備註" onclick="searchData()" tabindex="-1">搜尋</button>
            </div>
            <div class="header-group hidden">
                <label for="DCL_DOC_EXAM">賣方驗證號碼</label>
                <input type="text" id="DCL_DOC_EXAM" name="DCL_DOC_EXAM">
            </div>
            <div class="header-group">
                <label for="SHPR_BONDED_ID">海關監管編號</label>
                <input type="text" id="SHPR_BONDED_ID" name="SHPR_BONDED_ID" oninput="filterAlphanumeric(this)"
                placeholder="(非保稅此欄免填)">
            </div>
            <div class="header-group">
                <label for="SHPR_C_NAME">出口人中文名稱</label>
                <input type="text" id="SHPR_C_NAME" name="SHPR_C_NAME" tabindex="-1">
            </div>
            <div class="header-group">
                <label for="SHPR_E_NAME">出口人英文名稱</label>
                <input type="text" id="SHPR_E_NAME" name="SHPR_E_NAME" tabindex="-1">
            </div>
            <div class="header-group">
                <label for="SHPR_C_ADDR">出口人中文地址</label>
                <input type="text" id="SHPR_C_ADDR" name="SHPR_C_ADDR" tabindex="-1">
            </div>
            <div class="header-group">
                <label for="SHPR_E_ADDR">出口人英文地址</label>
                <input type="text" id="SHPR_E_ADDR" name="SHPR_E_ADDR" tabindex="-1">
            </div>
            <div class="header-group">
                <label for="SHPR_TEL" style="background: #ffffff00;">出口人電話號碼</label>
                <input type="text" id="SHPR_TEL" name="SHPR_TEL" tabindex="-1">
            </div>
            <div class="header-group hidden">
                <label for="IMP_QUAL" style="background: #ffffff00;">進口資格</label>
                <input type="text" id="IMP_QUAL" name="IMP_QUAL" tabindex="-1">
            </div>
            <div class="header-group hidden">
                <label for="EXP_QUAL" style="background: #ffffff00;">出口資格</label>
                <input type="text" id="EXP_QUAL" name="EXP_QUAL" tabindex="-1">
            </div>            
            <hr>
            <div class="header-group hidden" id="cnee_c_name_group">
                <label for="CNEE_C_NAME" style="background: #ffffff00;">買方中文名稱</label>
                <input type="text" id="CNEE_C_NAME" name="CNEE_C_NAME" tabindex="-1"
                placeholder="(非必填，若客戶要求名稱分開可填列)">
            </div>
            <div class="header-group">
                <label for="CNEE_E_NAME" id="toggleCneeName" title="可點選分開買方中/英名稱欄位">買方中/英名稱</label>
                <input type="text" id="CNEE_E_NAME" name="CNEE_E_NAME">
            </div>
            <div class="header-group">
                <label for="CNEE_E_ADDR" style="background: #ffffff00;">買方中/英地址</label>
                <input type="text" id="CNEE_E_ADDR" name="CNEE_E_ADDR" tabindex="-1"
                placeholder="(非必填，若客戶要求可填列，通知出口備註)">
            </div>
            <div class="header-group">
                <label for="CNEE_COUNTRY_CODE">買方國家代碼</label>
                <input type="text" id="CNEE_COUNTRY_CODE" name="CNEE_COUNTRY_CODE" oninput="filterAlphabets(this)"
                placeholder="範例：HK、CN、KR、SG(英文代碼)">
            </div>
            <div class="header-group">
                <label for="CNEE_BAN_ID" style="background: #ffffff00;">買方統一編號</label>
                <input type="text" id="CNEE_BAN_ID" name="CNEE_BAN_ID" oninput="filterAlphanumeric(this)"
                placeholder="(買方國家代碼為TW，此欄需填列)" onkeydown="preventArrowKeyAdjustment(event)">
                <a href="https://fbfh.trade.gov.tw/fb/web/queryBasicf.do" target="_blank" rel="noopener noreferrer" 
                style="padding-left: 4px; padding-top: 4px; font-weight: normal; color: #005feec5;" tabindex="-1">
                    廠商基本資料查詢
                </a>
            </div>
            <hr>
            <div class="header-group hidden">
                <label for="BUYER_BAN">收貨人統一編號</label>
                <input type="text" id="BUYER_BAN" name="BUYER_BAN">
            </div>
            <div class="header-group">
                <label for="BUYER_E_NAME" style="background: #ffffff00;">收方名稱</label>
                <input type="text" id="BUYER_E_NAME" name="BUYER_E_NAME"
                placeholder="(買方國家代碼為TW，此欄需填列)">
            </div>
            <div class="header-group">
                <label for="BUYER_E_ADDR" style="background: #ffffff00;">收方地址</label>
                <input type="text" id="BUYER_E_ADDR" name="BUYER_E_ADDR"
                placeholder="(買方國家代碼為TW，此欄需填列)">
            </div>
            <div class="header-group" style="position: relative;">
                <label for="TO_CODE">目的地(代碼)</label>
                <input type="text" id="TO_CODE" name="TO_CODE" 
                    placeholder="範例：HKHKG、CNSZX、KRICN、SGSIN(英文代碼)">
            </div>
            <div class="header-group" style="position: relative;">
                <label for="TO_DESC">目的地(名稱)</label>
                <input type="text" id="TO_DESC" name="TO_DESC" tabindex="-1"
                    placeholder="(英文名稱，可關鍵字查詢)">
                <div id="search-results" class="search-results"></div>
            </div>
        </div>
        
        <div class="header-section">
            <div class="header-group">
                <label for="TOT_CTN">總件數</label>
                <input type="number" id="TOT_CTN" name="TOT_CTN" min="1" step="1" onkeydown="preventArrowKeyAdjustment(event)">
            </div>
            <div class="header-group">
                <label for="DOC_CTN_UM">總件數單位</label>
                <input type="text" id="DOC_CTN_UM" name="DOC_CTN_UM" oninput="filterAlphabets(this)"
                placeholder="範例：CTN、PKG、BOX、PLT(英文代碼)">
            </div>
            <div class="header-group">
                <label for="CTN_DESC" style="background: #ffffff00;">包裝說明</label>
                <input type="text" id="CTN_DESC" name="CTN_DESC" tabindex="-1"
                placeholder="(一般倉或ECFA包裝說明)">
            </div>
            <div class="header-group">
                <label for="DCL_GW">總毛重</label>
                <input type="number" id="DCL_GW" name="DCL_GW" onkeydown="preventArrowKeyAdjustment(event)">
            </div>
            <div class="header-group">
                <label for="DCL_NW">總淨重</label>
                <input type="number" id="DCL_NW" name="DCL_NW" onkeydown="preventArrowKeyAdjustment(event)">
            </div>
        </div>

        <div class="header-section">
            <div class="header-group">
                <label for="DCL_DOC_TYPE">報單類別</label>
                <input type="text" id="DCL_DOC_TYPE" name="DCL_DOC_TYPE" list="member"
                placeholder="(下拉式選單)">
                <datalist id="member">
                    <option value="G5">國貨出口</option>
                    <option value="G3">外貨復出口</option>
                    <option value="B8">保稅廠進口貨物(原料)復出口</option>
                    <option value="B9">保稅廠產品出口</option>
                    <option value="D5">保稅倉貨物出口</option>
                    <option value="F5">自由港區貨物出口</option>
                </datalist>
            </div>
            <div class="header-group">
                <label for="TERMS_SALES">貿易條件</label>
                <input type="text" id="TERMS_SALES" name="TERMS_SALES" list="terms"
                placeholder="(下拉式選單)">
                <datalist id="terms">
                    <option value="EXW">需填列應加費用，不得填列運保費</option>
                    <option value="FOB">不含運費、保險費</option>
                    <option value="CFR">含運費</option>
                    <option value="C&I">含保險費</option>
                    <option value="CIF">含運費、保險費</option>
                </datalist>
            </div>
            <div class="header-group">
                <label for="CURRENCY">幣別</label>
                <input type="text" id="CURRENCY" name="CURRENCY" style="flex: 4 1 0;"
                placeholder="範例：TWD、USD、CNY、JPY、EUR(英文代碼)" oninput="filterAlphabets(this); lookupExchangeRate();"
                onblur="checkTotalAmount();">
                <input type="text" id="exchange-rate" name="exchange-rate" tabindex="-1"
                readonly placeholder="當旬匯率" style="flex: 1 1 0; max-width: 80px; text-align: center; border: 2px solid #ccc;">

                <input type="text" id="usd-exchange-rate" name="usd-exchange-rate" tabindex="-1"
                readonly placeholder="美金匯率" 
                style="flex: 1 1 0; max-width: 80px; text-align: center; border: 2px solid #ccc; margin-left: 4px; display: none;">

                <span id="currency-error" class="input-error">幣別錯誤，請重新輸入</span>
            </div>
            <div class="header-group">
                <label for="CAL_IP_TOT_ITEM_AMT">總金額</label>
                <input type="number" id="CAL_IP_TOT_ITEM_AMT" name="CAL_IP_TOT_ITEM_AMT"
                placeholder="(若為台幣總金額不可有小數點、EXW 總金額不含應加費用)"
                onblur="checkTotalAmount();"
                onkeydown="preventArrowKeyAdjustment(event)">
            </div>
            <hr>
            <div class="header-group">
                <label for="FRT_AMT">運費</label>
                <input type="number" id="FRT_AMT" name="FRT_AMT" tabindex="-1"
                placeholder="(CFR、CIF 需填列運費，EXW 不得填列運費)" onkeydown="preventArrowKeyAdjustment(event)">
                <button id="calculate-freight-button">計算運費</button>
            </div>   
            <div class="header-group">
                <label for="INS_AMT">保險費</label>
                <input type="number" id="INS_AMT" name="INS_AMT" tabindex="-1"
                placeholder="(C&I、CIF 需填列保險費，EXW 不得填列保險費)" onkeydown="preventArrowKeyAdjustment(event)">
                <button id="calculate-insurance-button">計算保險費</button>
            </div>
            <div class="header-group">
                <label for="ADD_AMT">應加費用</label>
                <input type="number" id="ADD_AMT" name="ADD_AMT" tabindex="-1" style="flex: 1 1 0;"
                placeholder="(EXW 需填列應加費用)" onkeydown="preventArrowKeyAdjustment(event)">
                <button id="calculate-additional-button" style="flex: 1 1 0; max-width: 200px;">計算應加費用(TWD500)</button>
            </div>
            <div class="header-group">
                <label for="SUBTRACT_AMT">應減費用</label>
                <input type="number" id="SUBTRACT_AMT" name="SUBTRACT_AMT" tabindex="-1"
                placeholder="(EXW 不得填列應減費用)" onkeydown="preventArrowKeyAdjustment(event)">
            </div>
        </div>

        <div class="header-section">
            <div class="header-group">
                <label for="DOC_MARKS_DESC">標記及貨櫃號碼</label>
                <textarea id="DOC_MARKS_DESC" name="DOC_MARKS_DESC" rows="5"></textarea>
                <button type="button" class="vertical-text" onclick="toggleRows('DOC_MARKS_DESC', this)" tabindex="-1">展開</button>
            </div>
            <div class="button-group">
                <button type="button" data-tooltip="TW" onclick="fillText('MADE IN TAIWAN')">台灣</button>
                <button type="button" data-tooltip="CN" onclick="fillText('MADE IN CHINA')" tabindex="-1">中國</button>
                <button type="button" data-tooltip="HK" onclick="fillText('MADE IN HONG KONG')" tabindex="-1">香港</button>
                <button type="button" data-tooltip="JP" onclick="fillText('MADE IN JAPAN')" tabindex="-1">日本</button>
                <button type="button" data-tooltip="KR" onclick="fillText('MADE IN KOREA')" tabindex="-1">韓國</button>
                <button type="button" data-tooltip="SG" onclick="fillText('MADE IN SINGAPORE')" tabindex="-1">新加坡</button>
                <button type="button" data-tooltip="MY" onclick="fillText('MADE IN MALAYSIA')" tabindex="-1">馬來西亞</button>
                <button type="button" data-tooltip="PH" onclick="fillText('MADE IN PHILIPPINES')" tabindex="-1">菲律賓</button>
                <button type="button" data-tooltip="TH" onclick="fillText('MADE IN THAILAND')" tabindex="-1">泰國</button>
                <button type="button" data-tooltip="VN" onclick="fillText('MADE IN VIETNAM')" tabindex="-1">越南</button>
                <button type="button" data-tooltip="US" onclick="fillText('MADE IN UNITED STATES')" tabindex="-1">美國</button>
                <button type="button" data-tooltip="CA" onclick="fillText('MADE IN CANADA')" tabindex="-1">加拿大</button>
                <button type="button" data-tooltip="GB" onclick="fillText('MADE IN UNITED KINGDOM')" tabindex="-1">英國</button>
                <button type="button" data-tooltip="DE" onclick="fillText('MADE IN GERMANY')" tabindex="-1">德國</button>
                <button type="button" data-tooltip="FR" onclick="fillText('MADE IN FRANCE')" tabindex="-1">法國</button>
                <button type="button" data-tooltip="CH" onclick="fillText('MADE IN SWITZERLAND')" tabindex="-1">瑞士</button>
                <button type="button" data-tooltip="ES" onclick="fillText('MADE IN SPAIN')" tabindex="-1">西班牙</button>
                <button type="button" data-tooltip="IT" onclick="fillText('MADE IN ITALY')" tabindex="-1">義大利</button>
            </div>
            <div class="header-group">
                <label for="DOC_OTR_DESC">其它申報事項</label>
                <textarea id="DOC_OTR_DESC" name="DOC_OTR_DESC" rows="5"></textarea>
                <button type="button" class="vertical-text" onclick="toggleRows('DOC_OTR_DESC', this)" tabindex="-1">展開</button>
            </div>
            <div>
                <select id="doc_otr_desc_dropdown" class="custom-select" style="width: 180px;"> <!-- 調整這裡的寬度 -->
                    <option value="">備註選單</option>
                    <option value="國貨樣品/贈送不再進口">【統計方式04】國貨樣品/贈送不再進口</option>
                    <option value="委外加工不再進口">【統計方式05】委外加工不再進口</option>
                    <option value="國外提供原料委託加工出口(僅收取加工費)">【統計方式06】國外提供原料委託加工出口(僅收取加工費)</option>
                    <option value="此為貨樣出口，後續將依規定限期內復運進口">【統計方式53/9E】此為貨樣出口，後續將依規定限期內復運進口</option>
                    <option value="本批貨物為國貨修理後復出口">【統計方式91】本批貨物為國貨修理後復出口</option>
                    <option value="委外加工再復運進口">【統計方式95】委外加工再復運進口(需註明耗損率、預估完成數量、完成貨名)</option>
                    <option value="洋貨復出口，復出口原因：退回修理，修理完畢後會再復運進口">【統計方式9M】洋貨復出口，復出口原因：退回修理，修理完畢後會再復運進口(需註明產品序列號、損壞原因、預期完成修復率)</option>
                    <option value="戰略性高科技貨品
輸出許可證號碼 Export Permit No.：
出口管制貨品號碼 Export Control Commodity NO.：">【統計方式1A/8A/8D】戰略性高科技貨品</option>
                    <optgroup label="─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─"></optgroup>
                    <option value="洋貨轉售，附原進口報單">【統計方式81】洋貨轉售，附原進口報單</option>
                    <option value="洋貨轉售，因無法提供原進口報單號碼，特附國內購買憑證以茲證明">【統計方式81】洋貨轉售，因無法提供原進口報單號碼，特附國內購買憑證以茲證明</option>
                    <option value="洋貨轉售，因無法取得原進口報單及購買憑證，願繳納推廣貿易服務費">【統計方式81】洋貨轉售，因無法取得原進口報單及購買憑證，願繳納推廣貿易服務費</option>
                    <optgroup label="─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─"></optgroup>
                    <option value="洋貨復出口不再進口，附原進口報單">【統計方式82】洋貨復出口不再進口(贈送/樣品/不良品退回)，附原進口報單</option>
                    <option value="洋貨復出口不再進口，因無法提供原進口報單號碼，特附國內購買憑證以茲證明">【統計方式82】洋貨復出口不再進口(贈送/樣品/不良品退回)，因無法提供原進口報單號碼，特附國內購買憑證以茲證明</option>
                    <option value="洋貨復出口不再進口，因無法取得原進口報單及購買憑證，願繳納推廣貿易服務費">【統計方式82】洋貨復出口不再進口(贈送/樣品/不良品退回)，因無法取得原進口報單及購買憑證，願繳納推廣貿易服務費</option>
                </select>
                <button id="summarizeButton" data-tooltip="品名(發票號碼)、統計方式、生產國別、原進口報單，填列完成後再進行匯整" onclick="summarizeOrgCountry()">匯整產地及備註</button>
                <button id="checkBtn">長期委任字號</button>
            </div>
            <div class="header-group hidden">
                <label for="REMARK1">REMARKS</label>
                <textarea id="REMARK1" name="REMARK1" rows="5"></textarea>
                <button type="button" class="vertical-text" onclick="toggleRows('REMARK1', this)" tabindex="-1">展開</button>
            </div>
        </div>

        <!--申請報單副本-->
        <div class="header-section">
            <div class="flex-group">
                <input type="checkbox" id="copy_3_e" name="copy_option" tabindex="-1">申請沖退原料稅(E化退稅)<br>
            </div>
            <div class="flex-group">
                <input type="checkbox" id="copy_3" name="copy_option" tabindex="-1">申請報單副本第三聯(沖退原料稅用聯)<br>
            </div>
            <div class="flex-group">
                <input type="checkbox" id="copy_4" name="copy_option" tabindex="-1">申請報單副本第四聯(退內地稅用聯)<span style="color: red">【補充稅照號碼】</span><br>
            </div>
            <div class="flex-group">
                <input type="checkbox" id="copy_5" name="copy_option" tabindex="-1">申請報單副本第五聯(出口證明用聯)<br>
            </div>  
        </div>
        
        <input type="hidden" id="APP_DUTY_REFUND" value="">
        <input type="hidden" id="MARK_TOT_LINES" value="">
        <input type="hidden" id="EXAM_TYPE" value="">
        <input type="hidden" id="COPY_QTY" value="">
        <div class="reminder-message reminder-message-red">
            【提醒！】<br>
            如果需申請沖退原料稅或報單副本，請務必記得勾選，<br>
            系統會將其它需要填列的欄位自動進行設定，自動設定的欄位有：<br>
            1. 申請審驗方式<br>
            2. 報單副本份數<br>
            3. 申請沖退原料稅<br>
            4. 檢附外銷品使用原料及其供應商資料表<br>
            5. 其它申報事項
        </div>

        <!-- 用於顯示變數值 -->
        <div id="variables" style="display:none;">
            <input type="hidden" id="APP_DUTY_REFUND" value="N">
            <input type="hidden" id="MARK_TOT_LINES" value="N">
            <input type="hidden" id="EXAM_TYPE" value="">
            <input type="hidden" id="COPY_QTY" value="0">
        </div>     

        <!-- 製單人員 -->
        <div style="margin-top: 10px; margin-bottom: 20px;">
            <label for="Maker">製單人員</label>
            <input type="text" id="Maker" name="Maker" readonly>
        </div>
        
    </div>

    <!--出口報單項次-->
    <div id="items" class="tab">
        <div id="header-container">
            <div class="container">
                <div class="add-buttons">
                    <button onclick="openItemModal()" title="快捷鍵 Alt + A">新增項次(可複製)</button>
                    <button onclick="openSpecifyFieldModal()">指定填列欄位資料</button>
                    <button onclick="openAdjustOrderModal()">調整項次順序</button>
                    <button onclick="openToggleFieldsModal()">顯示隱藏欄位</button>
                    <button id="toggle-all-btn" onclick="toggleAllTextareas()" title="快捷鍵 Alt + W">展開全部品名</button>

                    <!-- 攤重按鈕 -->
                    <button id="spread-weight-btn" onclick="openSpreadWeightModal()" title="快捷鍵
Alt + 1 全部項次
Alt + 2 指定項次">攤重</button>
                    
                    <!-- 攤重設定彈跳框 -->
                    <div id="spread-weight-modal">
                        <div id="modal-header">
                            <h3 style="margin: 0;">攤重</h3>
                            <div style="gap: 5px;">
                                <!-- 確認按鈕 -->
                                <button onclick="applySpreadWeight()" id="confirm-button" title="快捷鍵 Alt + Enter">確定</button>
                                <!-- 取消按鈕 -->
                                <button onclick="closeSpreadWeightModal()" tabindex="-1" title="快捷鍵 Esc">取消</button>
                            </div>
                        </div>
                        <br>
                        <form id="spread-weight-form">
                            <label>
                                選擇模式：
                                <select id="spread-mode" tabindex="-1" >
                                    <option value="1">全部項次</option>
                                    <option value="2">指定項次</option>
                                </select>
                                <br><br>
                            </label>
                            <div id="specific-options" style="display: none;">
                                <label>
                                    指定項次No. (例如: 3,5-7)<br>
                                    <input type="text" id="specific-range">
                                </label>
                                <br><br>
                                <label>
                                    指定項次總重量：<br>
                                    <input type="number" id="specific-weight" min="1">
                                </label>
                                <br><br>
                                <label>
                                    攤重後是否鎖定：
                                    <div style="margin-top: 5px;">
                                        <label style="margin-right: 10px;">
                                            <input type="radio" name="lock-after-distribution" value="yes" checked>
                                            是
                                        </label>
                                        <label>
                                            <input type="radio" name="lock-after-distribution" value="no">
                                            否
                                        </label>
                                    </div>
                                </label>
                                <br>
                            </div>
                            <label>
                                重量小數位 (0-6)：
                                <input type="number" id="weight-decimal-places" value="2" min="0" max="6">
                            </label>
                        </form>
                    </div>

                    <!-- 透明遮罩 -->
                    <div id="drag-overlay"></div>

                    <button id="calculate-amounts-btn" style="color: #005feec5;" onclick="calculate()" title="快捷鍵 Alt + Q">核算</button>
                    <input type="number" id="decimal-places" placeholder="金額小數位" min="0" max="6" style="width: 60px; font-size: 12px;">
                    <input type="text" id="calculation-status" placeholder="核算狀態" style="display: none;">
                </div>
            </div>
            <div class="container">
                <div class="add-buttons">
                    <input type="checkbox" id="toggle-fix-top" onclick="toggleFixTop()">
                    <label for="toggle-fix-top">固定欄位標題</label>
                    <input type="checkbox" id="toggle-width" onclick="toggleWidth()">
                    <label for="toggle-width">固定頁面寬度</label>
                    <a href="https://hscode.customs.gov.tw" target="_blank" rel="noopener noreferrer" 
                        style="margin-left: auto; padding-left: 10px; color: #005feec5;" tabindex="-1">
                        貨品歸屬稅則查詢
                    </a>
                </div>
                <!-- 快捷鍵說明獨立區塊 -->
                <div id="shortcut-help-block" class="shortcut-help-block">
                    快捷鍵
                    <!-- 快捷鍵說明彈跳框 -->
                    <div id="shortcut-help-modal" class="shortcut-help-modal">
                        <h3>快捷鍵</h3>
                        <ul>
                            <li>Ctrl + 左／右方向鍵：切換標籤頁</li>
                            <li>Ctrl + 鼠標捲軸：放大縮小頁面</li>
                            <li>Ctrl + F：搜尋頁面內容</li>
                            <li>Ctrl + Z：撤銷操作（或 Alt + Backspace）</li>
                            <li>Ctrl + Shift + Z：重做操作（或 Ctrl + Y）</li>
                            <li>Alt + A：開啟新增項次彈跳框</li>
                            <li>Alt + S：儲存新增項次（彈跳框內）</li>
                            <li>Alt + S：新增項次 - 橫屏（彈跳框內最後顯示的畫面內容）</li>
                            <li>Alt + W：切換展開／收合全部品名</li>
                            <li>Alt + Q：核算</li>
                            <li>Alt + R：出口備註</li>
                            <li>Alt + 1：攤重 - 全部項次</li>
                            <li>Alt + 2：攤重 - 指定項次</li>    
                            <li>Alt + 左／右方向鍵：頁面左右捲動（固定頁面寬度時）</li>
                            <li>Alt + 上／下方向鍵：欄位移動</li>
                            <li>Home／End：移至頁面最上方／最下方</li>
                            <li>Page Up／Page Down：頁面上下捲動</li>
                            <li>Win + 左／右方向鍵：頁面靠左／靠右</li>
                            <li>Win + 上／下方向鍵：頁面全屏展開／收合</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="item-row item-header">
                <div class="form-group fix item-no item-no-header" onclick="toggleAllItems()">
                    <label>No.</label>
                </div>
                <div class="form-group fix">
                    <label style="font-size: 12px;">大品名註記</label>
                </div>
                <div class="form-group fix item-number">
                    <label>項次</label>
                </div>
                <div class="form-group DESCRIPTION" style="width: 200%;">
                    <label>品名</label>
                </div>
                <div class="form-group QTY" style="width: 60%;">
                    <label>數量</label>
                </div>
                <div class="form-group DOC_UM" style="width: 40%;">
                    <label>單位</label>
                </div>
                <div class="form-group DOC_UNIT_P" style="width: 60%;">
                    <label>單價</label>
                </div>
                <div class="form-group DOC_TOT_P" style="width: 80%;">
                    <label>金額</label>
                </div>
                <div class="form-group TRADE_MARK" style="width: 80%;">
                    <label>商標</label>
                </div>
                <div class="form-group CCC_CODE" style="width: 105%;">
                    <label>稅則</label>
                </div>
                <div class="form-group ST_MTD" style="width: 30%;">
                    <label>統計方式</label>
                </div>
                <div class="form-group ISCALC_WT" style="width: 24px; text-align: center;">
                    <label>鎖定</label>
                    <div class="form-group">
                        <input type="checkbox" id="selectAllWT">
                        <label for="selectAllWT"></label>
                    </div>
                </div>
                <div class="form-group NET_WT" style="width: 60%;">
                    <label>淨重</label>
                </div>
                <div class="form-group ORG_COUNTRY hidden" style="width: 30%;">
                    <label>生產國別</label>
                </div>
                <div class="form-group ORG_IMP_DCL_NO hidden">
                    <label>原進口報單號碼</label>
                </div>
                <div class="form-group ORG_IMP_DCL_NO_ITEM hidden" style="width: 30%;">
                    <label>原進口報單項次</label>
                </div>
                <div class="form-group SELLER_ITEM_CODE hidden" style="width: 130%;">
                    <label>賣方料號</label>
                </div>
                <div class="form-group BOND_NOTE hidden" style="width: 30%;">
                    <label>保稅貨物註記</label>
                </div>
                <div class="form-group GOODS_MODEL hidden" style="width: 60%;">
                    <label>型號</label>
                </div>
                <div class="form-group GOODS_SPEC hidden" style="width: 60%;">
                    <label>規格</label>
                </div>
                <div class="form-group CERT_NO hidden">
                    <label>產證號碼</label>
                </div>
                <div class="form-group CERT_NO_ITEM hidden" style="width: 30%;">
                    <label>產證項次</label>
                </div>
                <div class="form-group ORG_DCL_NO hidden">
                    <label>原進倉報單號碼</label>
                </div>
                <div class="form-group ORG_DCL_NO_ITEM hidden" style="width: 30%;">
                    <label>原進倉報單項次</label>
                </div>
                <div class="form-group EXP_NO hidden">
                    <label>輸出許可號碼</label>
                </div>
                <div class="form-group EXP_SEQ_NO hidden" style="width: 30%;">
                    <label>輸出許可項次</label>
                </div>
                <div class="form-group WIDE hidden" style="width: 60%;">
                    <label>寬度(幅寬)</label>
                </div>
                <div class="form-group WIDE_UM hidden"  style="width: 40%;">
                    <label>寬度單位</label>
                </div>
                <div class="form-group LENGT_ hidden" style="width: 60%;">
                    <label>長度(幅長)</label>
                </div>
                <div class="form-group LENGTH_UM hidden" style="width: 40%;">
                    <label>長度單位</label>
                </div>     
                <div class="form-group ST_QTY hidden" style="width: 60%;">
                    <label>統計數量</label>
                </div>  
                <div class="form-group ST_UM hidden" style="width: 40%;">
                    <label>統計單位</label>
                </div>         
                <div class="form-group fix">
                    <button type="button" class="delete-item-btn">刪除</button>
                </div>
            </div>
        </div>
        <p style="margin-top: 10px;"></p>        
        <div id="item-container"></div>
    </div>

    <!-- 新增項次彈跳框 -->
    <div id="item-modal" class="modal">
        <div class="modal-content">
            <div class="floating-buttons">
                <button id="rememberButton" onclick="rememberItemModalData()">記憶</button>
                <button onclick="clearAllFields()">清空</button>
                ｜
                <button onclick="saveItem()" title="快捷鍵 Alt + S">儲存</button>
                <button onclick="closeItemModal()">取消</button>
            </div>
            <div class="modal-header" id="item-modal-header">
                <h2>新增項次</h2>
            </div>
            <div class="flex-group">
                <input type="checkbox" id="ITEM_NO" name="HAS_MAJOR_NAME" onchange="toggleMajorName(event)" tabindex="-1">
                <label for="ITEM_NO">大品名註記(勾選大品名註記時，只需填寫品名)</label>
            </div>
            <div class="header-group">
                <label for="COPY_ITEM">選擇項次複製</label>
                <select id="COPY_ITEM">
                    <option value="">選擇項次</option>
                </select>
            </div>
            <div class="header-group">
                <label for="DESCRIPTION">品名</label>
                <textarea id="DESCRIPTION" class="DESCRIPTION" rows="5"></textarea>
                <button type="button" class="vertical-text" onclick="toggleDescriptionRows()" tabindex="-1">展開</button>
            </div>
            <div class="header-group">
                <label for="QTY">數量</label>
                <input type="number" id="QTY" class="QTY" min="0" oninput="calculateAmount(event)">
            </div>
            <div class="header-group">
                <label for="DOC_UM">單位</label>
                <input type="text" id="DOC_UM" class="DOC_UM"
                    placeholder="範例：EAC、PCE、SET、YRD、MTR(英文代碼)">
            </div>
            <div class="header-group">
                <label for="DOC_UNIT_P">單價</label>
                <input type="number" id="DOC_UNIT_P" class="DOC_UNIT_P" min="0" oninput="calculateAmount(event)">
            </div>
            <div class="header-group">
                <label for="DOC_TOT_P">金額</label>
                <input type="number" id="DOC_TOT_P" class="DOC_TOT_P" min="0" readonly tabindex="-1">
            </div>
            <div class="header-group">
                <label for="TRADE_MARK">商標</label>
                <input type="text" id="TRADE_MARK" class="TRADE_MARK" name="TRADE_MARK" list="trademark-list"
                    placeholder="範例：NO BRAND(無商標)、FIG(圖樣)、文字(字樣)">
                <datalist id="trademark-list">
                    <option value="NO BRAND">無商標</option>
                    <option value="FIG">圖樣</option>
                </datalist>
            </div>
            <div class="header-group">
                <label for="CCC_CODE" id="CCC_CODE_LABEL">稅則</label>
                <input type="text" id="CCC_CODE" class="CCC_CODE"
                    placeholder="可輸入關鍵字按Enter查詢後選取(台灣稅則－共11碼，前6碼國際通用)" onkeydown="handleCCCCodeEnter(event, this)">
            </div>
            <div class="header-group">
                <label for="ST_MTD">統計方式</label>
                <input type="text" id="ST_MTD" class="ST_MTD" name="ST_MTD" list="method-list">
                <datalist id="method-list">
                    <option value="02">國貨銷售</option>
                    <option value="04">國貨樣品/贈送</option>
                    <option value="81">洋貨銷售</option>
                    <option value="82">洋貨樣品/贈送/不良品退回</option>
                </datalist>
            </div>
            <div class="header-group">
                <label for="NET_WT">淨重</label>
                <input type="number" id="NET_WT" class="NET_WT" min="0">
            </div>
            <hr>
            <div class="header-group">洋貨復出口核銷欄位</div>
            <div class="header-group">
                <label for="ORG_COUNTRY">生產國別</label>
                <input type="text" id="ORG_COUNTRY" class="ORG_COUNTRY"
                placeholder="範例：US、CN、JP、GB(英文代碼)">
            </div>
            <div class="header-group">
                <label for="ORG_IMP_DCL_NO">原進口報單號碼</label>
                <input type="text" id="ORG_IMP_DCL_NO" class="ORG_IMP_DCL_NO"
                placeholder="範例：CX  13709IPORT(中間為兩位空格) 或 CXDA13709IPORT(共14碼)"
                oninput="updateTaxCodeHighlight()">
            </div>
            <div class="header-group">
                <label for="ORG_IMP_DCL_NO_ITEM">原進口報單項次</label>
                <input type="number" id="ORG_IMP_DCL_NO_ITEM" class="ORG_IMP_DCL_NO_ITEM">
            </div>
            <hr>
            <div class="header-group">保稅貨物欄位</div>
            <div class="header-group">
                <label for="SELLER_ITEM_CODE">賣方料號</label>
                <input type="text" id="SELLER_ITEM_CODE" class="SELLER_ITEM_CODE"
                placeholder="(出口報單會自動加上前綴 S/N:)">
            </div>
            <div class="header-group">
                <label for="BOND_NOTE">保稅貨物註記</label>
                <input type="text" id="BOND_NOTE" class="BOND_NOTE"
                placeholder="範例：YB(保品)、NB(非保品)">
            </div>
            <hr>
            <div class="header-group">ECFA產證欄位</div>
            <div class="header-group">
                <label for="GOODS_MODEL">型號</label>
                <input type="text" id="GOODS_MODEL" class="GOODS_MODEL"
                placeholder="(出口報單會自動加上前綴 MODEL:)">
            </div>
            <div class="header-group">
                <label for="GOODS_SPEC">規格</label>
                <input type="text" id="GOODS_SPEC" class="GOODS_SPEC"
                placeholder="(出口報單會自動加上前綴 SPEC:)">
            </div>
            <div class="header-group">
                <label for="CERT_NO">產證號碼</label>
                <input type="text" id="CERT_NO" class="CERT_NO"
                    placeholder="範例：DN24CE00072(共11碼)">
            </div>
            <div class="header-group">
                <label for="CERT_NO_ITEM">產證項次</label>
                <input type="number" id="CERT_NO_ITEM" class="CERT_NO_ITEM">
            </div>
            <hr>
            <div class="header-group">D5保稅倉核銷欄位</div>
            <div class="header-group">
                <label for="ORG_DCL_NO">原進倉報單號碼</label>
                <input type="text" id="ORG_DCL_NO" class="ORG_DCL_NO"
                placeholder="範例：CX  13709IPORT(中間為兩位空格) 或 CXDA13709IPORT(共14碼)"
                oninput="updateTaxCodeHighlight()">
            </div>
            <div class="header-group">
                <label for="ORG_DCL_NO_ITEM">原進倉報單項次</label>
                <input type="number" id="ORG_DCL_NO_ITEM" class="ORG_DCL_NO_ITEM">
            </div>
            <hr>
            <div class="header-group">管制品欄位</div>
            <div class="header-group">
                <label for="EXP_NO">輸出許可號碼</label>
                <input type="text" id="EXP_NO" class="EXP_NO"
                    placeholder="範例：FTSI11W0000079(共14碼)">
            </div>
            <div class="header-group">
                <label for="EXP_SEQ_NO">輸出許可項次</label>
                <input type="number" id="EXP_SEQ_NO" class="EXP_SEQ_NO">
            </div>
            <hr>
            <div class="header-group">布貨品欄位</div>
            <div class="header-group">
                <label for="WIDE">寬度(幅寬)</label>
                <input type="number" id="WIDE" class="WIDE">
            </div>
            <div class="header-group">
                <label for="WIDE_UM">寬度單位</label>
                <input type="text" id="WIDE_UM" class="WIDE_UM"
                placeholder="範例：INC、YRD、MTR(英文代碼)">
            </div>
            <div class="header-group">
                <label for="LENGT_">長度(幅長)</label>
                <input type="number" id="LENGT_" class="LENGT_">
            </div>
            <div class="header-group">
                <label for="LENGTH_UM">長度單位</label>
                <input type="text" id="LENGTH_UM" class="LENGTH_UM"
                placeholder="範例：INC、YRD、MTR(英文代碼)">
            </div> 
            <hr>
            <div class="header-group">與數量單位不同另外填列</div>
            <div class="header-group">
                <label for="ST_QTY">統計數量</label>
                <input type="number" id="ST_QTY" class="ST_QTY">
            </div>
            <div class="header-group">
                <label for="ST_UM">統計單位</label>
                <input type="text" id="ST_UM" class="ST_UM" readonly tabindex="-1"
                placeholder="(由稅則統計數量單位自動帶入)">
            </div>           
        </div>
    </div>

    <!-- 稅則查詢彈跳框 -->
    <div id="taxmodal" class="taxmodal">
        <div class="taxmodal-content">
            <span class="close">&times;</span>
            <div id="modal-results"></div>
        </div>
    </div>

    <!-- 調整順序彈跳框 -->
    <div id="adjust-order-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="adjust-order-modal-header">
                <h2>調整順序</h2>
            </div>
            <h4>【直接拖曳調整項次的排列順序】</h4>
            <div id="order-list" class="order-list">
                <!-- 動態生成的項次列表 -->
            </div>
            <div class="floating-buttons">
                <button onclick="saveNewOrder()">儲存</button>
                <button onclick="closeOrderModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 指定填列欄位資料的彈跳框 -->
    <div id="specify-field-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="specify-field-modal-header">
                <h2>指定填列欄位資料</h2>
            </div>
            <div class="header-group">
                <label for="specify-mode">模式</label>
                <select id="specify-mode" onchange="toggleSpecifyMode()">
                    <option value="custom">自定義填列內容</option>
                    <option value="copy">從源項次複製內容</option>
                </select>
            </div>
            <div id="custom-content" class="specify-mode-content">
                <div class="header-group">
                    <label for="specify-item-numbers">No. (例如: 3,5-7)</label>
                    <input type="text" id="specify-item-numbers"
                        placeholder="(未填則默認全部項次)">
                </div>
                <div class="header-group">
                    <label for="specify-field-name">欄位名稱</label>
                    <select id="specify-field-name">
                        <option value="DESCRIPTION">品名</option>
                        <option value="QTY">數量</option>
                        <option value="DOC_UM">單位</option>
                        <option value="DOC_UNIT_P">單價</option>
                        <option value="TRADE_MARK">商標</option>
                        <option value="CCC_CODE">稅則</option>
                        <option value="ST_MTD">統計方式</option>
                        <option value="NET_WT">淨重</option>
                        <option class="separator" disabled>洋貨復出口核銷欄位</option>
                        <option value="ORG_COUNTRY">生產國別</option>
                        <option value="ORG_IMP_DCL_NO">原進口報單號碼</option>
                        <option value="ORG_IMP_DCL_NO_ITEM">原進口報單項次</option>
                        <option class="separator" disabled>保稅貨物欄位</option>
                        <option value="SELLER_ITEM_CODE">賣方料號</option>
                        <option value="BOND_NOTE">保稅貨物註記</option>
                        <option class="separator" disabled>ECFA產證欄位</option>
                        <option value="GOODS_MODEL">型號</option>
                        <option value="GOODS_SPEC">規格</option>
                        <option value="CERT_NO">產證號碼</option>
                        <option value="CERT_NO_ITEM">產證項次</option>
                        <option class="separator" disabled>D5保稅倉核銷欄位</option>
                        <option value="ORG_DCL_NO">原進倉報單號碼</option>
                        <option value="ORG_DCL_NO_ITEM">原進倉報單項次</option>
                        <option class="separator" disabled>管制品欄位</option>
                        <option value="EXP_NO">輸出許可號碼</option>
                        <option value="EXP_SEQ_NO">輸出許可項次</option>
                        <option class="separator" disabled>布貨品欄位</option>
                        <option value="WIDE">寬度(幅寬)</option>
                        <option value="WIDE_UM">寬度單位</option>
                        <option value="LENGT_">長度(幅長)</option>
                        <option value="LENGTH_UM">長度單位</option>
                        <option class="separator" disabled>與數量單位不同另外填列</option>
                        <option value="ST_QTY">統計數量</option>
                    </select>
                </div>
                <!-- 新增起始編號輸入框，只在選擇產證序號時顯示 -->
                <div id="start-number-container" style="display: none;">
                    <label for="start-number">起始編號:</label>
                    <input type="number" id="start-number" value="1" min="1" class="small-input">
                </div>

                <div class="header-group">
                    <label for="specify-field-value" title="若需複製欄位，則填'=欄位名稱'">填列內容</label>
                    <textarea id="specify-field-value"></textarea>
                </div>
            </div>
            <div id="copy-content" class="specify-mode-content" style="display:none;">
                <div class="header-group">
                    <label for="source-item-number">源項次</label>
                    <select id="source-item-number">
                        <option value="">選擇項次</option>
                    </select>
                </div>
                <div class="header-group">
                    <label for="specify-field-names-copy">欄位名稱<br>(按住Ctrl或Shift可複選)</label>
                    <select id="specify-field-names-copy" multiple style="height: 380px;">
                        <option value="DESCRIPTION">品名</option>
                        <option value="QTY">數量</option>
                        <option value="DOC_UM">單位</option>
                        <option value="DOC_UNIT_P">單價</option>
                        <option value="TRADE_MARK">商標</option>
                        <option value="CCC_CODE">稅則</option>
                        <option value="ST_MTD">統計方式</option>
                        <option value="NET_WT">淨重</option>
                        <option class="separator" disabled>洋貨復出口核銷欄位</option>
                        <option value="ORG_COUNTRY">生產國別</option>
                        <option value="ORG_IMP_DCL_NO">原進口報單號碼</option>
                        <option value="ORG_IMP_DCL_NO_ITEM">原進口報單項次</option>
                        <option class="separator" disabled>保稅貨物欄位</option>
                        <option value="SELLER_ITEM_CODE">賣方料號</option>
                        <option value="BOND_NOTE">保稅貨物註記</option>
                        <option class="separator" disabled>ECFA產證欄位</option>
                        <option value="GOODS_MODEL">型號</option>
                        <option value="GOODS_SPEC">規格</option>
                        <option value="CERT_NO">產證號碼</option>
                        <option value="CERT_NO_ITEM">產證項次</option>
                        <option class="separator" disabled>D5保稅倉核銷欄位</option>
                        <option value="ORG_DCL_NO">原進倉報單號碼</option>
                        <option value="ORG_DCL_NO_ITEM">原進倉報單項次</option>
                        <option class="separator" disabled>管制品欄位</option>
                        <option value="EXP_NO">輸出許可號碼</option>
                        <option value="EXP_SEQ_NO">輸出許可項次</option> 
                        <option class="separator" disabled>布貨品欄位</option>
                        <option value="WIDE">寬度(幅寬)</option>
                        <option value="WIDE_UM">寬度單位</option>
                        <option value="LENGT_">長度(幅長)</option>
                        <option value="LENGTH_UM">長度單位</option>
                        <option class="separator" disabled>與數量單位不同另外填列</option>
                        <option value="ST_QTY">統計數量</option>
                    </select>
                </div>
                <div class="header-group">
                    <label for="target-item-numbers">No. (例如: 3,5-7)</label>
                    <input type="text" id="target-item-numbers"
                        placeholder="(未填則默認全部項次)">
                </div>
            </div>
            <div class="header-group">
                <label for="overwrite-option">覆蓋選項</label>
                <select id="overwrite-option">
                    <option value="all">全部覆蓋</option>
                    <option value="empty">覆蓋未填列之項次</option>
                    <option value="specified">覆蓋已填列之項次</option>
                    <option value="matchCondition">符合條件</option>
                    <option value="notMatchCondition">不符合條件</option>
                </select>
            </div>
            <!-- 當選擇「符合條件」或「不符合條件」時，顯示原欄位輸入框 -->
            <div class="header-group" id="original-field-container" style="display: none;">
                <label for="original-field-input" id="original-field-label">條件：原欄位 = </label>
                <input type="text" id="original-field-input">
            </div>
            <div class="floating-buttons">
                <button onclick="applyFieldData()">儲存</button>
                <button onclick="closeSpecifyFieldModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 顯示隱藏欄位彈跳框 -->
    <div id="toggle-fields-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>顯示隱藏欄位</h2>
            </div>
            <div class="header-group">
                <label for="field-select">選擇欄位<br>(按住Ctrl或Shift可複選)</label>
                <select id="field-select" multiple>
                    <optgroup label="必填欄位">
                        <option value="DESCRIPTION">品名</option>
                        <option value="QTY">數量</option>
                        <option value="DOC_UM">單位</option>
                        <option value="DOC_UNIT_P">單價</option>
                        <option value="DOC_TOT_P">金額</option>
                        <option value="TRADE_MARK">商標</option>
                        <option value="CCC_CODE">稅則</option>
                        <option value="ST_MTD">統計方式</option>
                        <option value="ISCALC_WT">鎖定</option>
                        <option value="NET_WT">淨重</option>
                    </optgroup>
                    <option class="separator" disabled>洋貨復出口核銷欄位</option>
                    <option value="ORG_COUNTRY">生產國別</option>
                    <option value="ORG_IMP_DCL_NO">原進口報單號碼</option>
                    <option value="ORG_IMP_DCL_NO_ITEM">原進口報單項次</option>
                    <option class="separator" disabled>保稅貨物欄位</option>
                    <option value="SELLER_ITEM_CODE">賣方料號</option>
                    <option value="BOND_NOTE">保稅貨物註記</option>
                    <option class="separator" disabled>ECFA產證欄位</option>
                    <option value="GOODS_MODEL">型號</option>
                    <option value="GOODS_SPEC">規格</option>
                    <option value="CERT_NO">產證號碼</option>
                    <option value="CERT_NO_ITEM">產證項次</option>
                    <option class="separator" disabled>D5保稅倉核銷欄位</option>
                    <option value="ORG_DCL_NO">原進倉報單號碼</option>
                    <option value="ORG_DCL_NO_ITEM">原進倉報單項次</option>
                    <option class="separator" disabled>管制品欄位</option>
                    <option value="EXP_NO">輸出許可號碼</option>
                    <option value="EXP_SEQ_NO">輸出許可項次</option>
                    <option class="separator" disabled>布貨品欄位</option>
                    <option value="WIDE">寬度(幅寬)</option>
                    <option value="WIDE_UM">寬度單位</option>
                    <option value="LENGT_">長度(幅長)</option>
                    <option value="LENGTH_UM">長度單位</option>
                    <option class="separator" disabled>與數量單位不同另外填列</option>
                    <option value="ST_QTY">統計數量</option>
                    <option value="ST_UM">統計單位</option>
                </select>
            </div>
            <div class="floating-buttons">
                <button onclick="applyToggleFields()">套用</button>
                <button onclick="closeToggleFieldsModal()">取消</button>
            </div>
        </div>
    </div>
    
    <!--保稅相關信息-->
    <div id="bonded" class="tab">
        <div class="header-section">
            <div class="header-group">
                <label for="FAC_BAN_ID_EX">保稅廠統一編號</label>
                <input type="text" id="FAC_BAN_ID_EX" name="FAC_BAN_ID_EX" oninput="filterAlphanumeric(this)">
            </div>
            <div class="header-group">
                <label for="FAC_BONDED_ID_EX">保稅廠監管編號</label>
                <input type="text" id="FAC_BONDED_ID_EX" name="FAC_BONDED_ID_EX" oninput="filterAlphanumeric(this)">
            </div>
            <hr>
            <div class="header-group">
                <label for="FAC_BAN_ID">出倉保稅倉庫統一編號</label>
                <input type="text" id="FAC_BAN_ID" name="FAC_BAN_ID" oninput="filterAlphanumeric(this)">
            </div>
            <div class="header-group">
                <label for="FAC_BONDED_ID">出倉保稅倉庫代碼</label>
                <input type="text" id="FAC_BONDED_ID" name="FAC_BONDED_ID" oninput="filterAlphanumeric(this)">
            </div>
            <hr>
            <div class="header-group">
                <label for="IN_BONDED_BAN">進倉保稅倉庫統一編號</label>
                <input type="text" id="IN_BONDED_BAN" name="IN_BONDED_BAN" oninput="filterAlphanumeric(this)">
            </div>
            <div class="header-group">
                <label for="IN_BONDED_CODE">進倉保稅倉庫代碼</label>
                <input type="text" id="IN_BONDED_CODE" name="IN_BONDED_CODE" oninput="filterAlphanumeric(this)">
            </div>
        </div>
        <div class="reminder-message reminder-message-blue">
            【註】此頁適用於以下出貨型態：<br>
            1. 出口人非保稅廠，由另外合作的供應商（保稅廠）負責出貨<br>👉載明「本批貨物由xxx保稅工廠供應，除該保稅工廠得申請除帳外，出口廠商不得申請退稅」字樣<br>
            2. 報單類別為 D5 保稅倉貨物出口<br>
            3. 報單類別為 F5 自由港區貨物出口
        </div>
        <div style="margin-top: 15px;">
            <label style="padding-right: 20px;">
                <input type="checkbox" id="general-warehouse">
                <span>一般倉</span>
            </label>
            <label for="DOC_DOC_NO_Last5">報單號碼(後5碼)</label>
            <input type="text" id="DOC_DOC_NO_Last5" name="DOC_DOC_NO_Last5" maxlength="5"
            oninput="filterAlphanumeric(this)" style="height: 30px;"
            placeholder="(限一般倉)">
        </div>
    </div>

    <!--轉檔客戶專區-->
    <div id="transfer-customer" class="tab" style="text-align: center;">
        <!-- 影片鏈接部分 -->
        <div class="video-link">
            <select id="videoSelector" onchange="updateVideoLink()" tabindex="-1">
                <option value="video/Transfer_Customer.mp4">轉檔客戶</option>
                <option value="video/Interface_Operation.mp4">介面操作</option>
            </select>
            <a id="videoLink" href="video/Transfer_Customer.mp4" target="_blank" rel="noopener noreferrer" tabindex="-1">【觀看影片】</a>
        </div>
        <table border="1" style="margin: 0 auto;">
            <thead>
                <tr>
                    <th style="text-align: center;">客戶名稱</th>
                    <th style="text-align: center;">檔案類型</th>
                    <th style="text-align: center;">注意事項</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="width: 35%;">
                        <div class="convert-file" onclick="document.getElementById('CustomerXMLInput22099408').click()">22099408 台灣光罩股份有限公司</div>
                        <input type="file" id="CustomerXMLInput22099408" accept=".xml" style="display:none" onchange="importCustomer22099408(event)">
                    </td>
                    <td style="text-align: center; width: 15%;">XML</td>
                    <td style="text-align: left; width: 50%;">【戰略性高科技貨品】品名（含出口管制貨品號碼）、稅則、輸出許可號碼、輸出許可項次，需與輸出許可證內容相符。</td>
                </tr>
                <tr>
                    <td style="width: 35%;">
                        <div class="convert-file" onclick="document.getElementById('CustomerExcelInput23570158').click()">23570158 利保國際股份有限公司</div>
                        <input type="file" id="CustomerExcelInput23570158" accept=".xlsx, .xls" style="display:none" onchange="importCustomer23570158(event)">
                    </td>
                    <td style="text-align: center; width: 15%;">Excel</td>
                    <td style="text-align: left; width: 50%;">【專項客戶】不需填買方地址，嘜頭依 Packing List 圖形為準（讀取前兩個工作表，越南件幅寬 I/J 欄、稅則 L/M 欄）</td>
                </tr>
                <tr>
                    <td style="width: 35%;">
                        <div class="convert-file" onclick="document.getElementById('CustomerXMLInput27951609').click()">27951609 群聯電子股份有限公司竹南分公司</div>
                        <input type="file" id="CustomerXMLInput27951609" accept=".xml" style="display:none" onchange="importCustomer27951609(event)">
                    </td>
                    <td style="text-align: center; width: 15%;">XML</td>
                    <td style="text-align: left; width: 50%;"></td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!--各標籤頁下方-->
    <div class="import-export-buttons">
        <input type="file" id="import-excel" accept=".xlsx, .xls" style="display:none;">
        <button class="excel-btn" onclick="document.getElementById('import-excel').click();" tabindex="-1">匯入Excel</button>
        <button class="excel-btn" id="export-excel" tabindex="-1">匯出Excel</button>
        <div>　</div>
        <input type="file" id="import-xml" accept=".xml" style="display:none;">
        <button class="xml-btn" onclick="document.getElementById('import-xml').click();" tabindex="-1">匯入XML</button>
        <button class="xml-btn" id="export-to-xml" tabindex="-1">匯出XML</button>
        <div>　</div>
        <button id="export-to-pdf" tabindex="-1">出口報單預覽</button>
        <p style="margin-bottom: 30px;"></p>
    </div>
    <!-- 提示訊息 -->
    <div id="loadingMessage" 
     style="display:none; 
            position:fixed; 
            top:50%; 
            left:50%; 
            transform:translate(-50%, -50%); 
            padding:20px; 
            background: radial-gradient(ellipse, rgb(225, 236, 254), rgb(237, 243, 254));
            border:1px solid #ccc; 
            border-radius:10px; 
            box-shadow:0 4px 6px rgba(0, 0, 0, 0.3); 
            font-family:Arial, sans-serif; 
            font-size:16px; 
            text-align:center; 
            color:#333; 
            z-index:1000;">
        生成 PDF 需等候，請勿重複點選。
    </div>

        <script>
        document.addEventListener("DOMContentLoaded", function () {
            checkExportAccess();
        });

        function checkExportAccess() {
            const token = localStorage.getItem("token");
            const userRoles = JSON.parse(sessionStorage.getItem("userRoles") || "[]");

            if (!token || userRoles.length === 0) {
                window.location.href = "index.html";
                return;
            }

            if (!userRoles.includes("export") && !userRoles.includes("manager")) {
                alert("❌ 無權限進入【出口報單】");
                window.location.href = "index.html";
                return;
            }

        }

        // 🔄 **自動填入「製單人員」欄位**
        document.addEventListener("DOMContentLoaded", function () {
            setTimeout(() => {
                const username = sessionStorage.getItem("loggedInUser") || "未設定"; // 預設值「未設定」
                const makerField = document.getElementById("Maker");

                if (makerField) {
                    makerField.value = username;
                } else {
                    console.error("❌ 找不到 Maker 欄位！");
                }
            }, 500); // ⏳ 加入 500ms 延遲，確保 DOM 載入完成
        });

        // 🔄 每 12 小時檢查 Token 是否過期
        function checkTokenExpiration() {
            const token = localStorage.getItem("token");
            if (!token) {
                window.location.href = "index.html"; // 如果沒 Token，直接回登入頁
                return;
            }
            
            fetch(`${API_URL}/verify`, {
                method: "POST",
                headers: { "Authorization": `Bearer ${token}` }
            })
            .then(res => res.json())
            .then(data => {
                if (!data.valid) {
                    localStorage.removeItem("token"); // 清除 Token
                    sessionStorage.clear(); // 清除用戶資訊
                    window.location.href = "index.html"; // 跳回登入頁
                }
            })
            .catch(() => console.log("⚠️ 無法驗證 Token，可能是伺服器問題"));
        }
        
        // **每 12 小時檢查一次**
        setInterval(checkTokenExpiration, 12 * 60 * 60 * 1000);
        
        // **頁面載入時立即檢查**
        document.addEventListener("DOMContentLoaded", checkTokenExpiration);

    </script>

    <!-- ✅ 外部函式庫（載入順序：先基礎工具類，後進階功能） -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.6/JsBarcode.all.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js" defer></script>

    <!-- ✅ UI & 工具 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js" defer></script>

    <!-- ✅ 核心功能（載入順序：主處理器 -> 各個模組） -->
    <script src="Export_core/MainHandler.js" defer></script>
    <script src="Export_core/addonsAndTips.js" defer></script>
    <script src="Export_core/cccCode.js" defer></script>
    <script src="Export_core/itemHandler.js" defer></script>
    <script src="Export_core/fieldHandler.js" defer></script>
    <script src="Export_core/sortHandler.js" defer></script>
    <script src="Export_core/visibilityHandler.js" defer></script>
    <script src="Export_core/weightHandler.js" defer></script>
    <script src="Export_core/calcHandler.js" defer></script>
    <script src="Export_core/excelHandler.js" defer></script>
    <script src="Export_core/xmlHandler.js" defer></script>
    <script src="Export_core/exportToPDF.js" defer></script>

    <!-- ✅ 特定客戶轉換規則 -->
    <script src="transfer-customer/22099408.js" defer></script>
    <script src="transfer-customer/23570158.js" defer></script>
    <script src="transfer-customer/27951609.js" defer></script>
    
</body>
</html>
