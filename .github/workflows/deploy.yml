name: Deploy with API_URL Replacement

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    env:
      API_URL: ${{ secrets.API_URL }}  # ğŸ‘ˆ ç¢ºä¿ GitHub Actions è®€å– Secrets

    steps:
      - name: ğŸš€ å–å¾—æœ€æ–°ç¨‹å¼ç¢¼
        uses: actions/checkout@v3

      - name: â— æª¢æŸ¥ API_URL æ˜¯å¦ç‚ºç©º
        run: |
          if [[ -z "$API_URL" ]]; then
            echo "âŒ API_URL æœªè¨­å®šï¼Œè«‹æª¢æŸ¥ GitHub Secrets"
            exit 1
          else
            echo "âœ… API_URL å·²è¨­å®š: $API_URL"
          fi

      - name: æ›¿æ› API_URL
        run: |
          find ./ -type f \( -name "*.js" -o -name "*.html" \) -exec sed -i "s|API_URL_PLACEHOLDER|$API_URL|g" {} +

      - name: âœ… ç¢ºèªæ›¿æ›çµæœ
        run: grep -r "API_URL_PLACEHOLDER" . || echo "âœ… API_URL æ›¿æ›æˆåŠŸï¼"

      - name: ğŸ“¤ æ¨é€è®Šæ›´
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          git add -A
          git commit -m "ğŸš€ è‡ªå‹•æ›¿æ› API_URL" || echo "âœ… ç„¡éœ€æäº¤è®Šæ›´"
          git push || echo "âœ… ç„¡éœ€æ¨é€"
