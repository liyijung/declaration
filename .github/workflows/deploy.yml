name: Deploy with API_URL Replacement

on:
  push:
    branches:
      - main  # 只在 main 分支推送時執行

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: 🚀 取得最新程式碼
        uses: actions/checkout@v3

      - name: 替換 API_URL
        run: |
          find . -type f \( -name "*.js" -o -name "*.html" \) -exec sed -i 's|API_URL_PLACEHOLDER|${{ secrets.API_URL }}|g' {} +

      - name: ✅ 確認替換結果
        run: grep -r "API_URL_PLACEHOLDER" . || echo "✅ API_URL 替換成功"

      - name: 📤 推送變更（如果需要）
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          git add .
          git commit -m "🚀 自動替換 API_URL"
          git push || echo "✅ 無需推送"
